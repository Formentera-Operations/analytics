version: 2

models:
  - name: stg_hubspot__companies
    description: "Staged Hubspot companies data with flattened properties"
    columns:
      - name: company_id
        description: "Primary key - The unique identifier for each company"
        data_tests:
          - unique
          - not_null
          - dbt_expectations.expect_column_values_to_not_be_in_set:
              arguments:
                value_set: [-1]
              config:
                severity: warn

      - name: name
        description: "Company name"
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: is_archived
        description: "Flag indicating if the company record is archived"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [true, false]

      - name: status
        description: "Current status of the company"
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: lifecyclestage
        description: "Current lifecycle stage of the company"
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: email
        description: "Primary email address for the company"
        data_tests:
          - dbt_expectations.expect_column_values_to_match_regex:
              arguments:
                regex: '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
              config:
                severity: warn
    
      
      - name: is_active
        description: "Flag indicating if the company is currently active"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [true, false]
      - name: hubspot_owner_id
        description: "ID of the Hubspot owner for this company"
        data_tests:
          - not_null:
              config:
                severity: warn
      - name: country
        description: "Country where the company is located"
        data_tests:
          - dbt_expectations.expect_column_values_to_be_in_set:
              arguments:
                value_set: ["US", "CA", "GB", "AU"]  # Add more country codes as needed
              config:
                severity: warn
      - name: page_views
        description: "Number of page views"
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0
              config:
                severity: warn
      - name: total_visits
        description: "Total number of visits"
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0
              config:
                severity: warn
      - name: tax_exempt
        description: "Flag indicating if the company is tax exempt"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [true, false]
