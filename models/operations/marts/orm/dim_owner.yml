version: 2

models:
  - name: dim_owner
    description: >
      Owner 360 dimension — unified view of mineral royalty owners.
      Combines contact-based owners (persons with optional company association)
      and company-only owners (entities with no linked contact).
      One row per owner entity: contact_id-based for contacts (~19K),
      company_id-based for companies with no contacts (~45K).
      Entity type (LLC, Trust, Estate, LP, Corporation, Individual) is derived
      from company name patterns. Address prefers company address with fallback
      to contact address.
    columns:
      - name: owner_sk
        description: >
          Surrogate key — contact_sk for contact-based owners,
          company_sk for company-only owners
        data_tests:
          - unique
          - not_null

      - name: contact_id
        description: >
          HubSpot contact identifier. NULL for company-only owners.

      - name: company_id
        description: >
          FK to stg_hubspot__companies.company_id. NULL when a contact
          has no company association. Always populated for company-only owners.
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_hubspot__companies')
                field: company_id
              config:
                severity: warn

      - name: owner_source
        description: >
          Discriminator for owner origin: 'contact' for contact-based owners,
          'company_only' for companies with no linked contacts.
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['contact', 'company_only']

      - name: first_name
        description: Contact first name

      - name: last_name
        description: Contact last name

      - name: full_name
        description: >
          Derived full name — for contacts: coalesce of first+last, last only,
          first only, then email. For company-only: company_name.
        data_tests:
          - not_null:
              config:
                severity: warn

      - name: email
        description: Primary email address

      - name: email_domain
        description: Email domain

      - name: phone
        description: Primary phone number

      - name: mobile_phone
        description: Mobile phone number

      - name: job_title
        description: Job title or role

      - name: company_name
        description: >
          Legal entity name. For contact-based owners, from associated company
          (NULL if no association). Always populated for company-only owners.

      - name: entity_type
        description: >
          Derived entity classification from company name patterns.
          Values: LLC, Trust, Estate, LP, Corporation, Individual, NULL.
          NULL only for contact-based owners with no company association.

      - name: is_llc
        description: Whether the associated company is an LLC (name-based detection)

      - name: is_trust
        description: Whether the associated company is a trust (name-based detection)

      - name: address
        description: Mailing address — prefers company address_line_one, falls back to contact address

      - name: city
        description: City — prefers company, falls back to contact

      - name: state
        description: State — prefers company, falls back to contact

      - name: zip
        description: ZIP code — prefers company, falls back to contact

      - name: country
        description: Country — prefers company, falls back to contact

      - name: is_address_from_company
        description: >
          Whether the address was sourced from company (true) or contact (false).
          Always true for company-only owners.

      - name: tax_status
        description: Tax filing status (from company)

      - name: is_tax_exempt
        description: Whether the owner is tax exempt (from company)

      - name: tax_id_number
        description: SSN or EIN for 1099 reporting (from company)

      - name: revenue_payment_type
        description: Payment method for revenue (from company)

      - name: minimum_check_amount
        description: Minimum revenue check amount (from company)

      - name: dba_1099_name
        description: DBA name for 1099 forms (from company)

      - name: owner_number_ogsys
        description: OGSys owner number — entity resolution key (from company)

      - name: acquired_owner_number
        description: Previous owner number from acquisition (from company)

      - name: asset
        description: Asset or property association (from company)

      - name: is_company_active
        description: Whether the company entity is active (from company, NULL if no company)

      - name: is_working_interest_owner
        description: Whether the owner holds working interest (from company)

      - name: is_revenue_checks_on_hold
        description: Whether revenue checks are on hold (from company)

      - name: statement_delivery
        description: Statement delivery method (from company)

      - name: suspense_reason
        description: Reason payments are in suspense (from company)

      - name: rev_statement_delivery
        description: Revenue statement delivery preference (from contact)

      - name: rev_statement_email
        description: Email for revenue statement delivery (from contact)

      - name: lifecycle_stage
        description: HubSpot lifecycle stage

      - name: hubspot_owner_id
        description: HubSpot internal owner (sales rep) assigned to this contact

      - name: has_company
        description: >
          Whether this owner has a company record. Always true for
          company-only owners. True/false for contact-based owners.

      - name: created_at
        description: Record creation timestamp (from contact or company)

      - name: last_modified_at
        description: Record last modification timestamp (from contact or company)

      - name: _loaded_at
        description: dbt load timestamp
