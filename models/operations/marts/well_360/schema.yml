version: 2

models:
  - name: fct_well_test
    description: >
      Per-event production test fact for ProdView completions. Each row is one
      production test (PI test, injection ratio, flowback test, etc.) with
      measured volumes, calculated rates, quality ratios, pressure/temperature
      conditions, and ProdView-computed change-from-prior metrics.

      Enables PI trending, GOR/WOR monitoring, and test-over-test decline
      analysis by joining on (eid ORDER BY effective_date).

      **Grain:** one row per production test record (id_rec from PVT_PVUNITCOMPTEST).
      Tests are infrequent (typically monthly or quarterly per completion).

      **EID resolution:** same three-hop chain as fct_completion_downtime —
      test.id_rec_parent (completion ID) → completions.id_rec_parent (unit ID)
      → well_360.prodview_unit_id. api_10 fallback via completions. ~99.5% resolved.

      **Invalid tests:** rows with invalid_test = 'Y' are retained.
      Filter `WHERE coalesce(invalid_test, 'N') != 'Y'` for valid-only analyses.
    config:
      tags: ["marts", "fo", "well_360"]
    columns:
      - name: well_test_sk
        description: Surrogate key. MD5(id_rec). Unique per production test record.
        data_tests:
          - not_null
          - unique

      - name: id_rec
        description: ProdView production test record ID (natural key from PVT_PVUNITCOMPTEST).
        data_tests:
          - not_null

      - name: id_rec_comp
        description: ProdView completion record ID — the completion that was tested.
        data_tests:
          - not_null

      - name: eid
        description: >
          Well EID — canonical business key joining to well_360. NULL for completions
          without a well_360 match. ~99.5% resolved in dev build.
        data_tests:
          - not_null:
              config:
                severity: warn
          - relationships:
              arguments:
                to: ref('well_360')
                field: eid
              config:
                severity: warn

      - name: is_eid_unresolved
        description: True when EID join produced no match in well_360.
        data_tests:
          - not_null

      - name: effective_date
        description: Date the production test was performed.
        data_tests:
          - not_null

      - name: test_type
        description: >
          ProdView test type classification (e.g., Production, Injection, Flowback).

      - name: test_hours
        description: Duration of the test in hours.

      - name: invalid_test
        description: >
          'Y' if the test was flagged as invalid in ProdView (do not use flag).
          NULL or 'N' for valid tests. Do NOT filter this in the mart — retain all rows.

      - name: tested_by
        description: Name or ID of the person who conducted the test.

      - name: choke_size_64ths
        description: Choke size at time of test in 64ths of an inch.

      - name: oil_cond_rate_bbl_per_day
        description: Calculated oil + condensate rate in bbl/day from the test.

      - name: produced_gas_rate_mcf_per_day
        description: Calculated produced gas rate in Mcf/day from the test.

      - name: water_rate_bbl_per_day
        description: Calculated water rate in bbl/day from the test.

      - name: total_fluid_rate_bbl_per_day
        description: Total liquid (oil + water) rate in bbl/day from the test.

      - name: gross_boe_rate_bbl_per_day
        description: >
          Derived gross BOE rate: oil_cond_rate_bbl_per_day + produced_gas_rate_mcf_per_day / 6.
          Uses 6:1 gas-to-oil conversion. NULL inputs treated as 0.
        data_tests:
          - not_null

      - name: gas_oil_ratio_mcf_per_bbl
        description: Gas-oil ratio in Mcf/bbl calculated by ProdView.

      - name: condensate_gas_ratio_bbl_per_mcf
        description: Condensate-gas ratio in bbl/Mcf.

      - name: water_gas_ratio_bbl_per_mcf
        description: Water-gas ratio in bbl/Mcf.

      - name: total_bsw_pct
        description: Total basic sediment and water percentage (0-100 scale).

      - name: pressure_wellhead_psi
        description: Wellhead pressure in PSI at time of test.

      - name: pressure_bh_psi
        description: Bottom-hole pressure in PSI at time of test.

      - name: temperature_well_head_f
        description: Wellhead temperature in degrees Fahrenheit.

      - name: temperature_bottom_hole_f
        description: Bottom-hole temperature in degrees Fahrenheit.

      - name: allocation_flag
        description: Whether this test is used for allocation purposes.

      - name: deliverability_flag
        description: Whether this test is used for deliverability calculations.

      - name: regulatory_flag
        description: Whether this test is submitted for regulatory reporting.

      - name: _loaded_at
        description: Timestamp when this row was loaded into the data warehouse.

  - name: fct_production_target_daily
    description: >
      Daily production target rates per ProdView completion, with EID resolved
      from well_360. Enables target vs actual variance analysis when joined with
      fct_well_production_daily on (eid, allocation_date = target_daily_date).

      The parent target record (PVT_PVUNITCOMPTARGET) defines a target period
      with a type (Budget, Forecast) and optional ComboCurve forecast name.
      Child records (PVT_PVUNITCOMPTARGETDAY) provide per-day rates within
      that period. This fact denormalizes both levels into a single daily row.

      **Grain:** one row per daily target record (id_rec from PVT_PVUNITCOMPTARGETDAY).
      A completion may have multiple rows per date when target types overlap
      (e.g., Budget and Actuals for the same day).

      **EID resolution:** four-hop chain — target_daily.id_rec_parent → target.id_rec
      → target.id_rec_parent (completion ID) → completion.id_rec_parent (unit ID)
      → well_360.prodview_unit_id. 100% resolved in dev build.
    config:
      tags: ["marts", "fo", "well_360"]
    columns:
      - name: production_target_daily_sk
        description: Surrogate key. MD5(id_rec). Unique per daily target record.
        data_tests:
          - not_null
          - unique

      - name: id_rec
        description: ProdView daily target record ID (PVT_PVUNITCOMPTARGETDAY natural key).
        data_tests:
          - not_null

      - name: id_rec_target
        description: FK to the parent target period record (PVT_PVUNITCOMPTARGET.idrec).

      - name: id_rec_comp
        description: ProdView completion record ID this target belongs to.

      - name: eid
        description: >
          Well EID — canonical business key joining to well_360.
          100% resolved in dev build (all target records trace to a completion
          with a well_360 match).
        data_tests:
          - not_null:
              config:
                severity: warn
          - relationships:
              arguments:
                to: ref('well_360')
                field: eid
              config:
                severity: warn

      - name: is_eid_unresolved
        description: True when EID join produced no match in well_360.
        data_tests:
          - not_null

      - name: target_daily_date
        description: The specific date this target rate applies to. Join key with fct_well_production_daily.allocation_date.
        data_tests:
          - not_null

      - name: target_start_date
        description: Start date of the parent target period.

      - name: target_type
        description: Classification of the target period (Budget, Forecast, Actual, etc.).

      - name: cc_forecast_name
        description: ComboCurve forecast name driving this target period (from usertxt1 on parent record).

      - name: is_use_in_diff_from_target_calculations
        description: >
          True when this target period is flagged for use in difference-from-target
          calculations (ProdView's built-in variance engine).

      - name: target_daily_rate_oil_bbl_per_day
        description: Target daily oil rate in bbl/day.

      - name: target_daily_rate_gas_mcf_per_day
        description: Target daily gas rate in Mcf/day.

      - name: target_daily_rate_hcliq_bbl_per_day
        description: Target daily hydrocarbon liquid rate in bbl/day.

      - name: target_daily_rate_condensate_bbl_per_day
        description: Target daily condensate rate in bbl/day.

      - name: target_daily_rate_ngl_bbl_per_day
        description: Target daily NGL rate in bbl/day.

      - name: target_daily_rate_water_bbl_per_day
        description: Target daily water rate in bbl/day.

      - name: target_daily_rate_sand_bbl_per_day
        description: Target daily sand rate in bbl/day.

      - name: target_daily_rate_gross_boe_per_day
        description: >
          Derived gross BOE target rate: target_daily_rate_oil_bbl_per_day +
          target_daily_rate_gas_mcf_per_day / 6. Null inputs treated as 0.

      - name: _loaded_at
        description: Timestamp when this row was loaded into the data warehouse.

  - name: fct_completion_downtime
    description: >
      Event-level downtime fact for ProdView completions. Each row represents
      one contiguous downtime event (island of consecutive single-day records
      sharing the same downtime codes), retaining full production history.

      Replaces fct_eng_completion_downtimes functionally (legacy model retained
      until Sprint 7 deprecation). Both coexist as independent facts.

      **Grain:** one row per contiguous downtime event per completion. Multiple
      consecutive single-day downtime records with the same (id_rec_comp,
      downtime_code_1/2/3) are merged into a single event via the
      islands+gaps algorithm.

      **EID resolution:** three-hop chain — downtime.id_rec_parent (completion
      ID) → stg_prodview__completions.id_rec_parent (unit ID) →
      well_360.prodview_unit_id (primary). api_10 fallback via
      stg_prodview__completions.api_10. ~99.4% resolution in dev build.

      **Legacy cutoff removed:** the existing int_prodview__completion_downtimes
      filters to first_day > 2021-12-31. This fact carries full history.
    config:
      tags: ["marts", "fo", "well_360"]
    columns:
      - name: downtime_event_sk
        description: >
          Surrogate key. MD5(downtime_event_id). Unique per contiguous
          downtime event. Guaranteed unique across all rows.
        data_tests:
          - not_null
          - unique

      - name: downtime_event_id
        description: >
          Natural grain key. The minimum id_rec within the island of consecutive
          source records that form this contiguous event. Stable across runs.
        data_tests:
          - not_null

      - name: id_rec_comp
        description: >
          ProdView completion record ID (FK to stg_prodview__completions.id_rec).
          The completion that experienced this downtime event.
        data_tests:
          - not_null

      - name: eid
        description: >
          Well EID — canonical business key joining to well_360. NULL for
          completions without a well_360 match (non-operated, SWD, FP Griffin
          without EID backfill). ~99.4% resolved in dev build.
        data_tests:
          - not_null:
              config:
                severity: warn
          - relationships:
              arguments:
                to: ref('well_360')
                field: eid
              config:
                severity: warn

      - name: is_eid_unresolved
        description: >
          True when neither prodview_unit_id nor api_10 join produced an EID
          match in well_360. Resolves automatically as EIDs are backfilled.
        data_tests:
          - not_null

      - name: event_start_date
        description: >
          First day of the contiguous downtime event (min first_day across
          merged source records in this island).
        data_tests:
          - not_null

      - name: event_end_date
        description: >
          Last day of the contiguous downtime event (max last_day across
          merged source records in this island). NULL for open-ended events.

      - name: total_downtime_hours
        description: >
          Total hours of downtime across all source records in this island.
          For non-single-day events (Range, Calculated), this is the calculated
          total from the source record.
        data_tests:
          - not_null

      - name: days_down
        description: >
          Calendar days from event_start_date to event_end_date (inclusive).
          For open-ended events, measured to yesterday (current_date - 1).

      - name: downtime_code_1
        description: Primary downtime classification code (e.g., well type, equipment category).

      - name: downtime_code_2
        description: Secondary downtime classification code (reason category).

      - name: downtime_code_3
        description: Tertiary downtime classification code (sub-reason).

      - name: downtime_type
        description: >
          ProdView downtime entry type. "Single Day" events on consecutive dates
          with the same codes are merged into one event by the islands algorithm.
          Other types (Range, Calculated) form their own single-record events.

      - name: product
        description: Product stream affected by this downtime (Oil, Gas, Water, All, etc.).

      - name: location
        description: >
          Physical location of the downtime cause (Wellbore, Surface, Pipeline, etc.).

      - name: is_failure
        description: True when ProdView flagged this downtime as an equipment or system failure.

      - name: comments
        description: Free-text comments from the operator for this downtime event.

      - name: _loaded_at
        description: Timestamp when this row was loaded into the data warehouse.

  - name: fct_well_production_daily
    description: >
      Daily production volumes per ProdView unit, with EID resolved from well_360.
      Wide-column fact carrying all mart-relevant staging columns at the source
      grain (one row per id_rec_unit × allocation_date). No volume aggregation —
      analysts GROUP BY eid when they need well-level daily summaries.

      This is the EID-resolved replacement for fct_eng_volumes (legacy model
      retained until Sprint 7 deprecation). Both coexist as independent facts.

      **Grain:** one row per (id_rec_unit, allocation_date). For resolved wells,
      eid is populated. For unresolved wells, eid is NULL and id_rec_unit is the
      only grain discriminator.

      **EID resolution:** two-step COALESCE — prodview_unit_id primary,
      api_10 fallback. ~81.5% match rate on pvunitcomp units.
      Unresolved rows (non-operated, FP Griffin without EIDs, SWD wells) are
      retained with NULL eid and `is_eid_unresolved = true`.

      **Incremental watermark:** _fivetran_synced (stable Fivetran ingestion
      timestamp). The staging VIEW's _loaded_at always returns current_timestamp()
      and is not usable as a watermark. Initial build requires --full-refresh.

      **Upstream filter:** stg_prodview__units restricted to
      `unit_type = 'pvunitcomp'` — excludes facilities, external ins/outs,
      and meters (~3K units).
    config:
      tags: ["marts", "fo", "well_360"]
    columns:
      - name: well_production_daily_sk
        description: >
          Surrogate key. MD5(id_rec_unit, allocation_date). Unique at the
          source grain (one allocation record per ProdView unit per day, after
          Fivetran re-ingestion deduplication in the fact CTE). Using id_rec_unit
          directly avoids the EID-coalesce collision where multiple units sharing
          the same EID would produce identical surrogate keys on the same date.
        data_tests:
          - not_null
          - unique

      - name: eid
        description: >
          Well EID (Entity Identifier) — canonical business key joining to well_360.
          NULL for unresolved wells (FP Griffin wells without property_eid in
          ProdView, non-operated wells, SWD/injection wells). Resolves
          automatically as EIDs are backfilled in ProdView.
        data_tests:
          - not_null:
              config:
                severity: warn
          - relationships:
              arguments:
                to: ref('well_360')
                field: eid
              config:
                severity: warn
                # ~18.5% unresolved historically; improves as EIDs are backfilled

      - name: id_rec_unit
        description: >
          ProdView unit ID (FK to stg_prodview__units.id_rec). Carried for ALL
          rows — both resolved and unresolved — to support FK bridge context,
          ProdView-side debugging, and multi-unit EID disambiguation.
        data_tests:
          - not_null

      - name: allocation_date
        description: >
          Date of the daily allocation record. Grain key alongside id_rec_unit.
        data_tests:
          - not_null

      - name: is_eid_unresolved
        description: >
          True when neither the prodview_unit_id nor api_10 join produced an EID
          match in well_360. Resolves automatically as EIDs are added to ProdView.
        data_tests:
          - not_null

      - name: id_rec
        description: >
          ProdView daily allocation record ID (source natural key from
          PVT_PVUNITALLOCMONTHDAY). Useful for tracing back to the exact
          source record when debugging volume discrepancies.

      - name: id_rec_comp
        description: ProdView completion ID this allocation belongs to.

      - name: id_rec_comp_zone
        description: ProdView completion zone ID.

      - name: id_flownet
        description: ProdView flow network ID governing allocation hierarchy.

      - name: allocation_year
        description: Calendar year of the allocation date (convenience column).

      - name: allocation_month
        description: Calendar month (1-12) of the allocation date (convenience column).

      - name: allocation_day_of_month
        description: Day of month (1-31) of the allocation date (convenience column).

      - name: downtime_hours
        description: Hours the well was down (non-producing) on this allocation date.

      - name: operating_time_hours
        description: Hours the well was actively producing on this allocation date.

      - name: gathered_hcliq_bbl
        description: Gathered hydrocarbon liquid volumes in barrels (pre-allocation).

      - name: gathered_gas_mcf
        description: Gathered gas volumes in Mcf (pre-allocation).

      - name: gathered_water_bbl
        description: Gathered produced water volumes in barrels (pre-allocation).

      - name: gathered_sand_bbl
        description: Gathered sand volumes in barrels (pre-allocation).

      - name: allocated_hcliq_bbl
        description: Allocated hydrocarbon liquid (oil + condensate + NGL) in barrels.

      - name: allocated_oil_bbl
        description: Allocated oil production in barrels.

      - name: allocated_condensate_bbl
        description: Allocated condensate production in barrels.

      - name: allocated_ngl_bbl
        description: Allocated NGL production in barrels.

      - name: allocated_gas_eq_hcliq_mcf
        description: Gas equivalent of allocated hydrocarbon liquid in Mcf.

      - name: allocated_gas_mcf
        description: Allocated gas production in Mcf.

      - name: allocated_water_bbl
        description: Allocated produced water in barrels.

      - name: allocated_sand_bbl
        description: Allocated sand in barrels.

      - name: gross_boe
        description: >
          Daily gross barrel of oil equivalent. Formula: allocated_oil_bbl +
          (allocated_gas_mcf / 6). Uses 6:1 gas-to-oil conversion ratio
          (industry standard for US operations).
        data_tests:
          - not_null

      - name: alloc_factor_hcliq
        description: Hydrocarbon liquid allocation factor (unitless ratio).

      - name: alloc_factor_gas
        description: Gas allocation factor (unitless ratio).

      - name: alloc_factor_water
        description: Water allocation factor (unitless ratio).

      - name: alloc_factor_sand
        description: Sand allocation factor (unitless ratio).

      - name: new_prod_hcliq_bbl
        description: New production hydrocarbon liquid in barrels (excludes recovered load).

      - name: new_prod_oil_bbl
        description: New production oil in barrels.

      - name: new_prod_condensate_bbl
        description: New production condensate in barrels.

      - name: new_prod_ngl_bbl
        description: New production NGL in barrels.

      - name: new_prod_hcliq_gas_eq_mcf
        description: New production hydrocarbon liquid gas equivalent in Mcf.

      - name: new_prod_gas_mcf
        description: New production gas in Mcf.

      - name: new_prod_water_bbl
        description: New production water in barrels.

      - name: new_prod_sand_bbl
        description: New production sand in barrels.

      - name: wi_hcliq_pct
        description: Working interest percentage for hydrocarbon liquid (0-100 scale).

      - name: wi_gas_pct
        description: Working interest percentage for gas (0-100 scale).

      - name: wi_water_pct
        description: Working interest percentage for water (0-100 scale).

      - name: wi_sand_pct
        description: Working interest percentage for sand (0-100 scale).

      - name: nri_hcliq_pct
        description: Net revenue interest percentage for hydrocarbon liquid (0-100 scale).

      - name: nri_gas_pct
        description: Net revenue interest percentage for gas (0-100 scale).

      - name: nri_water_pct
        description: Net revenue interest percentage for water (0-100 scale).

      - name: nri_sand_pct
        description: Net revenue interest percentage for sand (0-100 scale).

      - name: deferred_hcliq_bbl
        description: Deferred (lost) hydrocarbon liquid production in barrels.

      - name: deferred_gas_mcf
        description: Deferred (lost) gas production in Mcf.

      - name: deferred_water_bbl
        description: Deferred (lost) water production in barrels.

      - name: deferred_sand_bbl
        description: Deferred (lost) sand production in barrels.

      - name: diff_target_hcliq_bbl
        description: Variance from target — hydrocarbon liquid in barrels (negative = below target).

      - name: diff_target_oil_bbl
        description: Variance from target — oil in barrels.

      - name: diff_target_condensate_bbl
        description: Variance from target — condensate in barrels.

      - name: diff_target_ngl_bbl
        description: Variance from target — NGL in barrels.

      - name: diff_target_gas_mcf
        description: Variance from target — gas in Mcf.

      - name: diff_target_water_bbl
        description: Variance from target — water in barrels.

      - name: diff_target_sand_bbl
        description: Variance from target — sand in barrels.

      - name: disp_sales_hcliq_bbl
        description: Disposition — hydrocarbon liquid sold in barrels.

      - name: disp_sales_oil_bbl
        description: Disposition — oil sold in barrels.

      - name: disp_sales_condensate_bbl
        description: Disposition — condensate sold in barrels.

      - name: disp_sales_ngl_bbl
        description: Disposition — NGL sold in barrels.

      - name: disp_sales_gas_mcf
        description: Disposition — gas sold in Mcf.

      - name: disp_fuel_gas_mcf
        description: Disposition — gas used as fuel in Mcf.

      - name: disp_flare_gas_mcf
        description: Disposition — gas flared in Mcf.

      - name: disp_incineration_gas_mcf
        description: Disposition — gas incinerated in Mcf.

      - name: disp_vent_gas_mcf
        description: Disposition — gas vented in Mcf.

      - name: disp_injected_gas_mcf
        description: Disposition — gas injected in Mcf.

      - name: disp_injected_water_bbl
        description: Disposition — water injected in barrels.

      - name: injection_well_hcliq_bbl
        description: Injection well hydrocarbon liquid volumes in barrels.

      - name: injection_well_gas_mcf
        description: Injection well gas volumes in Mcf.

      - name: injection_well_water_bbl
        description: Injection well water volumes in barrels.

      - name: injection_well_sand_bbl
        description: Injection well sand volumes in barrels.

      - name: cum_hcliq_bbl
        description: >
          ProdView cumulative hydrocarbon liquid production in barrels as of this
          date (running total maintained by ProdView at unit level).

      - name: cum_oil_bbl
        description: ProdView cumulative oil production in barrels as of this date.

      - name: cum_condensate_bbl
        description: ProdView cumulative condensate production in barrels as of this date.

      - name: cum_ngl_bbl
        description: ProdView cumulative NGL production in barrels as of this date.

      - name: cum_gas_mcf
        description: ProdView cumulative gas production in Mcf as of this date.

      - name: cum_water_bbl
        description: ProdView cumulative water production in barrels as of this date.

      - name: cum_sand_bbl
        description: ProdView cumulative sand production in barrels as of this date.

      - name: gathered_heat_mmbtu
        description: Gathered gas heat content in MMBtu.

      - name: gathered_heat_factor_btu_per_ft3
        description: Gathered gas heat factor in BTU/ft³.

      - name: allocated_heat_mmbtu
        description: Allocated gas heat content in MMBtu.

      - name: allocated_heat_factor_btu_per_ft3
        description: Allocated gas heat factor in BTU/ft³.

      - name: new_prod_heat_mmbtu
        description: New production heat content in MMBtu.

      - name: disp_sales_heat_mmbtu
        description: Sales gas heat content in MMBtu.

      - name: disp_fuel_heat_mmbtu
        description: Fuel gas heat content in MMBtu.

      - name: disp_flare_heat_mmbtu
        description: Flared gas heat content in MMBtu.

      - name: disp_vent_heat_mmbtu
        description: Vented gas heat content in MMBtu.

      - name: disp_incinerate_heat_mmbtu
        description: Incinerated gas heat content in MMBtu.

      - name: allocated_density_api
        description: Allocated liquid density in API gravity degrees.

      - name: sales_density_api
        description: Sales liquid density in API gravity degrees.

      - name: id_rec_meas_method
        description: FK to measurement method record (ProdView).

      - name: id_rec_test
        description: >
          FK to the well test record associated with this allocation day.
          Populated when a production test was run on this date. Used for
          joining to fct_well_test in Sprint 5.

      - name: id_rec_param
        description: >
          FK to the completion parameters record for this allocation day.
          Populated when pressure/temperature/choke data was recorded.

      - name: id_rec_downtime
        description: >
          FK to the downtime event record associated with this allocation day.
          Populated when downtime was recorded. Used for joining to
          fct_completion_downtime in Sprint 4.

      - name: id_rec_deferment
        description: FK to the deferment record explaining deferred volumes.

      - name: id_rec_status
        description: FK to the well status record for this allocation date.

      - name: id_rec_facility
        description: FK to the facility record this unit belongs to.

      - name: pump_efficiency_pct
        description: Pump efficiency percentage (0-100 scale).

      - name: created_at_utc
        description: Timestamp when the source ProdView record was created (UTC).

      - name: modified_at_utc
        description: Timestamp when the source ProdView record was last modified (UTC).

      - name: _fivetran_synced
        description: >
          Fivetran ingestion timestamp. Used as the incremental watermark —
          rows with _fivetran_synced newer than the fact table's max are
          included in each incremental run.

      - name: _loaded_at
        description: Timestamp when this row was loaded into the data warehouse.

  - name: fct_well_production_monthly
    description: >
      Monthly production volumes per well, joined with LOS financial context.
      Gold-layer fact — source-agnostic (ProdView today; additional sources
      can be unioned at the staging/intermediate layer without changing this
      model's column contract).

      **Grain:** one row per (eid, production_month) for resolved wells;
      one row per (id_rec_unit, production_month) for unresolved wells
      (eid IS NULL). Multiple ProdView units mapping to the same EID are
      collapsed into a single row.

      **EID resolution:** two-step COALESCE — prodview_unit_id primary,
      api_10 fallback. ~0.7% of unit-months are unresolved in production
      (historically ~18.5% before FP Griffin EID backfill was completed).
      Unresolved rows are retained with NULL eid and `is_eid_unresolved = true`.

      **LOS coverage:** ~24% in dev build (incremental fct_los has partial
      history). Full production build expected to exceed 50% LOS coverage.

      **Upstream filter:** stg_prodview__units restricted to
      `unit_type = 'pvunitcomp'` — excludes facilities, external ins/outs,
      and meters (~3K units).
    config:
      tags: ["marts", "fo", "well_360"]
    columns:
      - name: well_performance_monthly_sk
        description: >
          Surrogate key. For resolved wells: MD5(eid, production_month).
          For unresolved wells: MD5(id_rec_unit, production_month).
          Guaranteed unique across all rows.
        data_tests:
          - not_null
          - unique

      - name: eid
        description: >
          Well EID (Entity Identifier) — the canonical business key joining
          to well_360. NULL for unresolved wells (FP Griffin wells without
          property_eid backfilled in ProdView, non-operated wells, SWD wells).
        data_tests:
          - not_null:
              config:
                severity: warn
          - relationships:
              arguments:
                to: ref('well_360')
                field: eid
              config:
                severity: warn
                # ~0.7% unresolved as of 2026-02-19; historically ~18.5% before
                # FP Griffin EID backfill. Rows retained for volume completeness.

      - name: id_rec_unit
        description: >
          ProdView unit ID (FK to stg_prodview__units.id_rec). Populated for
          unresolved wells only; NULL for resolved wells where multiple units
          may map to one EID. Use for ProdView-side debugging of unresolved rows.

      - name: production_month
        description: >
          First day of the production month (date_trunc to month). Grain key
          alongside eid.
        data_tests:
          - not_null

      - name: is_eid_unresolved
        description: >
          True when neither the prodview_unit_id nor api_10 join produced an
          EID match in well_360. These rows represent FP Griffin wells awaiting
          EID backfill, non-operated wells, or SWD/injection wells. Resolves
          automatically as EIDs are added to ProdView.
        data_tests:
          - not_null

      - name: oil_bbls
        description: Monthly allocated oil production in barrels (bbls). 0 when null in source.

      - name: gas_mcf
        description: Monthly allocated gas production in thousand cubic feet (Mcf). 0 when null in source.

      - name: water_bbls
        description: Monthly allocated water production in barrels (bbls). 0 when null in source.

      - name: ngl_bbls
        description: Monthly allocated NGL production in barrels (bbls). 0 when null in source.

      - name: gross_boe
        description: >
          Monthly gross barrel of oil equivalent. Formula: oil_bbls + (gas_mcf / 6).
          Uses 6:1 gas-to-oil conversion ratio (industry standard for US operations).
        data_tests:
          - not_null

      - name: has_los_entry
        description: >
          True when int_los__well_monthly has a financial record for this
          (eid, production_month). False for months with no GL activity,
          pre-LOS-system history, or unresolved EIDs.
        data_tests:
          - not_null

      - name: los_revenue
        description: >
          Monthly LOS revenue for this well (GL category = 'Revenue').
          Pre-signed: positive. NULL when has_los_entry is false.

      - name: los_loe
        description: >
          Monthly lease operating expense (GL category = 'Lease Operating Expenses').
          Pre-signed: negative (costs are sign-flipped in fct_los). NULL when
          has_los_entry is false.

      - name: los_severance_tax
        description: >
          Monthly production and ad valorem taxes
          (GL category = 'Production & Ad Valorem Taxes'). Pre-signed: negative.
          NULL when has_los_entry is false.

      - name: los_net_income
        description: >
          Monthly net income — sum of all LOS categories for this well-month
          (Revenue + LOE + Severance Tax + all other signed categories).
          Because fct_los pre-signs all costs as negative, SUM gives net income
          directly. NULL when has_los_entry is false.

      - name: _loaded_at
        description: Timestamp when this row was loaded into the data warehouse.
